<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Search results for trucking companies on TruckFinder.">
    <meta name="keywords" content="search results, trucking, movers, logistics">
    <title>Search Results - TruckFinder</title>
    <link rel="stylesheet" href="trucking.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <nav>
            <h1>TruckFinder</h1>
            <ul>
                <li><a href="trucking.html">Home</a></li>
                <li><a href="trucking.html#search">Search</a></li>
                <li><a href="trucking.html#features">Features</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="add-listing.html">Add Listing</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="content-centered">
            <section id="results">
                <h2>Search Results</h2>
                <p id="results-summary">Showing results for your search.</p>
                
                <div class="filters">
                    <label for="sort">Sort by:</label>
                    <select id="sort">
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="company">Company Name</option>
                        <option value="rating">Average Rating</option>
                    </select>
                    
                    <label for="filter-truck">Filter by Truck Type:</label>
                    <select id="filter-truck">
                        <option value="">All Types</option>
                        <option value="Semi-Truck">Semi-Truck</option>
                        <option value="Box Truck">Box Truck</option>
                        <option value="Pickup Truck">Pickup Truck</option>
                    </select>
                </div>
                
                <div id="listings-container"></div>
            </section>
        </div>
    </main>

    <!-- Background Animations -->
    <div class="bg-animations">
        <div class="bg-gradient"></div>
        <div class="floating-cloud cloud1">☁️</div>
        <div class="floating-cloud cloud2">☁️</div>
        <div class="floating-cloud cloud3">☁️</div>
        <div class="particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>

        <video autoplay loop muted class="bg-video">
            <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <div class="truck-animation main-truck">
            <svg width="120" height="60" viewBox="0 0 120 60" class="truck-svg">
                <rect x="15" y="25" width="70" height="20" fill="#8b5cf6"/>
                <rect x="85" y="30" width="25" height="15" fill="#3b82f6"/>
                <circle cx="30" cy="45" r="6" fill="#000" class="wheel"/>
                <circle cx="90" cy="45" r="6" fill="#000" class="wheel"/>
                <ellipse cx="20" cy="20" rx="3" ry="2" fill="#ccc" opacity="0.7" class="exhaust"/>
                <rect x="20" y="20" width="10" height="8" fill="#ffffff" opacity="0.8"/>
                <circle cx="15" cy="30" r="2" fill="#fff"/>
            </svg>
        </div>

        <div class="truck-animation secondary">
            <svg width="100" height="50" viewBox="0 0 100 50" class="truck-svg">
                <rect x="10" y="20" width="50" height="15" fill="#3b82f6"/>
                <rect x="60" y="22" width="20" height="13" fill="#8b5cf6"/>
                <circle cx="20" cy="35" r="4" fill="#000" class="wheel"/>
                <circle cx="70" cy="35" r="4" fill="#000" class="wheel"/>
            </svg>
        </div>

        <div class="truck-animation tertiary">
            <svg width="80" height="40" viewBox="0 0 80 40" class="truck-svg">
                <rect x="5" y="15" width="40" height="12" fill="#8b5cf6"/>
                <rect x="45" y="17" width="15" height="10" fill="#3b82f6"/>
                <circle cx="15" cy="27" r="3" fill="#000" class="wheel"/>
                <circle cx="50" cy="27" r="3" fill="#000" class="wheel"/>
            </svg>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2026 TruckFinder. All rights reserved.</p>
            <nav>
                <a href="trucking.html">Home</a>
                <a href="trucking.html#search">Search</a>
                <a href="trucking.html#features">Features</a>
                <a href="about.html">About</a>
            </nav>
        </div>
    </footer>

    <script src="trucking.js"></script>
    <script>
        let allListings = [];
        let searchFiltered = [];
        let filteredListings = [];

        // Load and display search results
        window.addEventListener('load', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const from = urlParams.get('from') || '';
            const to = urlParams.get('to') || '';
            const date = urlParams.get('date') || '';

            try {
                const response = await fetch('/api/listings');
                allListings = await response.json();
                console.log('All listings:', allListings); // Debug
            } catch (error) {
                console.error('Error loading listings:', error);
                allListings = [];
            }

            searchFiltered = allListings.filter(listing => {
                const routeLower = listing.route.toLowerCase();
                const fromWords = from.toLowerCase().split(' ');
                const toWords = to.toLowerCase().split(' ');
                const matchesFrom = fromWords.some(word => routeLower.includes(word));
                const matchesTo = toWords.some(word => routeLower.includes(word));
                return matchesFrom && matchesTo;
            });
            console.log('Search filtered listings:', searchFiltered); // Debug
            filteredListings = [...searchFiltered];

            updateDisplay();

            // Event listeners for sorting and filtering
            document.getElementById('sort').addEventListener('change', applySorting);
            document.getElementById('filter-truck').addEventListener('change', applyFiltering);
        });

        function applySorting() {
            const sortBy = document.getElementById('sort').value;
            filteredListings.sort((a, b) => {
                switch (sortBy) {
                    case 'price-low':
                        return a.price - b.price;
                    case 'price-high':
                        return b.price - a.price;
                    case 'company':
                        return a.company.localeCompare(b.company);
                    case 'rating':
                        const avgA = a.reviews.reduce((sum, r) => sum + r.rating, 0) / a.reviews.length || 0;
                        const avgB = b.reviews.reduce((sum, r) => sum + r.rating, 0) / b.reviews.length || 0;
                        return avgB - avgA; // Higher rating first
                    default:
                        return 0;
                }
            });
            updateDisplay();
        }

        function applyFiltering() {
            const truckType = document.getElementById('filter-truck').value;
            filteredListings = truckType ? searchFiltered.filter(l => l.truckType === truckType) : [...searchFiltered];
            applySorting(); // Re-sort after filtering
        }

        function updateDisplay() {
            const summary = document.getElementById('results-summary');
            const container = document.getElementById('listings-container');

            if (filteredListings.length > 0) {
                const urlParams = new URLSearchParams(window.location.search);
                const from = urlParams.get('from') || '';
                const to = urlParams.get('to') || '';
                summary.textContent = `Found ${filteredListings.length} trucking option${filteredListings.length > 1 ? 's' : ''} for "${from} to ${to}".`;
                displayListings(filteredListings);
            } else {
                summary.textContent = `No results found. Try adjusting your filters or search criteria.`;
                container.innerHTML = '<p>No listings available. <a href="add-listing.html">Add one here</a>.</p>';
            }
        }

        function displayListings(listings) {
            const container = document.getElementById('listings-container');
            container.innerHTML = listings.map((listing, index) => {
                const avgRating = listing.reviews.length > 0 ? (listing.reviews.reduce((sum, r) => sum + r.rating, 0) / listing.reviews.length).toFixed(1) : 'No ratings';
                return `
                    <div class="listing-card">
                        <h3>${listing.company}</h3>
                        <p><i class="fas fa-truck"></i> ${listing.truckType}</p>
                        <p><i class="fas fa-route"></i> ${listing.route}</p>
                        <p><i class="fas fa-dollar-sign"></i> $${listing.price}</p>
                        <p><i class="fas fa-star"></i> Avg Rating: ${avgRating}/5 (${listing.reviews.length} reviews)</p>
                        <p><i class="fas fa-info-circle"></i> ${listing.description}</p>
                        <p><i class="fas fa-phone"></i> ${listing.contact}</p>
                        <button onclick="bookListing(${index})">Book Now</button>
                        <button onclick="toggleReviews(${index})">Reviews (${listing.reviews.length})</button>
                        <div id="reviews-${index}" class="reviews" style="display: none;">
                            ${listing.reviews.map(r => `<p><strong>${r.rating}/5:</strong> ${r.comment}</p>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function bookListing(index) {
            alert(`Booking request sent for ${filteredListings[index].company}. Contact: ${filteredListings[index].contact}`);
        }

        function toggleReviews(index) {
            const div = document.getElementById(`reviews-${index}`);
            div.style.display = div.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html></content>
<parameter name="filePath">c:\Users\coder\Desktop\trucking company\results.html